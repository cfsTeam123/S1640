@using S1640.Models
@model S1640.Models.InwardValidation
@{
    ViewBag.Title = "";
    Layout = "~/Views/Shared/_Layout.cshtml";
    S1640Entities conn = new S1640Entities();
    string mUserType = Convert.ToString(Session["UserType"]);

    // Fetch the records where MTransNo matches and DocDate is within the last 10 minutes
    var AllList = conn.InawardTables.Where(s => s.Status == "Unclean").ToList();
}
<script src="~/Scripts/jquery-3.3.1.js"></script>
<script src="~/Scripts/jquery.validate.min.js"></script>
<script src="~/Scripts/jquery.validate.unobtrusive.min.js"></script>
<!-- Toastify CSS -->
<link rel="stylesheet" type="text/css" href="https://cdn.jsdelivr.net/npm/toastify-js/src/toastify.min.css">

<!-- Toastify JS -->
<script type="text/javascript" src="https://cdn.jsdelivr.net/npm/toastify-js"></script>
<style>
    .custom-toast {
        background: linear-gradient(to right, #00c9ff, #92fe9d); /* Unique: cyan to mint green */
        border-radius: 10px;
        padding: 20px 28px;
        font-weight: bold;
        font-size: 18px;
        color: #fff;
        box-shadow: 0 30px 60px rgba(0, 0, 0, 0.3);
        max-width: 600px;
        min-width: 400px;
        text-align: center;
        position: fixed;
        top: 30px;
        left: 50%;
        transform: translateX(-50%);
        z-index: 9999;
        display: none;
    }
    .custom-toast1 {
        background: linear-gradient(to right, #ff416c, #ff4b2b);
        border-radius: 10px;
        padding: 20px 28px;
        font-weight: bold;
        font-size: 18px;
        color: #fff;
        box-shadow: 0 30px 60px rgba(0, 0, 0, 0.3);
        max-width: 600px;
        min-width: 400px;
        text-align: center;
        position: fixed;
        top: 30px;
        left: 50%;
        transform: translateX(-50%);
        z-index: 9999;
        display: none;
    }


</style>
<section role="main" class="content-body">
    <header class="page-header">
        <h2>Cleaning Area</h2>
        <div class="right-wrapper text-right" style="margin-right: 2%;">
            <ol class="breadcrumbs">
                <li>
                    <a href="~/Home/Index" title="Home">
                        <i class="fas fa-home"></i>
                    </a>
                </li>
            </ol>
        </div>
    </header>
    <!-- start: page -->
    <div class="row">
        <div class="col">
            <section class="card">
                <div class="card-body">
                    <div id="SDisplay" style="margin-top:65px"></div>
                    <div id="customToast" class="custom-toast"></div>   
                    <div id="customToast1" class="custom-toast1"></div>
                    <form action="" method="POST" onsubmit="MainSubmit.disabled = true; return true;">
                        @Html.AntiForgeryToken()
                        <div class="form-group row">
                            <div class="col-12">
                                <div class="table-responsive">
                                    <table class="table table-bordered table-striped table-hover mb-0" id="MyTable">
                                        <thead class="text-center">
                                            <tr>
                                                <th hidden></th>
                                                <th width="5%">SL No</th>
                                                <th width="20%">BarCode</th>
                                                <th width="10%">Bin Condition</th>
                                                <th width="10%">Bin Wash Status</th>
                                                <th width="10%">Bin Fill Status</th>
                                                <th width="10%">Action</th>
                                            </tr>
                                        </thead>
                                        <tbody id="tableCont">
                                            @{
                                                int rowNo = 0;
                                            }
                                            @foreach (var item in AllList)
                                            {
                                                var enqmst = conn.InawardTables.FirstOrDefault(x => x.MTransNo == item.MTransNo);
                                                <tr>
                                                    <td class="mtrans-no" hidden>@item.MTransNo</td>
                                                    <td class="text-center">@(++rowNo)</td>
                                                    <td>@item.BarCode</td>
                                                    <td>@item.BinCondition</td>
                                                    <td>@item.BinWash</td>
                                                    @*<td>
                                                            <select name="BinWashStatusList" class="form-control form-control-sm">
                                                                <option value="Clean" @(item.BinWash == "Clean" ? "selected" : "")>Clean</option>
                                                                <option value="Unclean" @(item.BinWash == "Unclean" ? "selected" : "")>Unclean</option>
                                                            </select>
                                                        </td>*@
                                                    <td>@item.BinFillStatus</td>
                                                    <td class="text-center">
                                                        <input type="checkbox" name="DtlCheckList" value="@item.MTransNo" class="form-check-input DtlCheck" />
                                                    </td>
                                                </tr>
                                            }
                                        </tbody>
                                    </table>
                                </div>
                            </div>
                        </div>

                        <!-- Submit and Cancel Buttons -->
                        <div class="form-group row mt-4">
                            <div class="col text-center">
                                <button type="submit" id="MainSubmit" class="btn btn-success btn-lg">Submit</button>
                                <a href="/Home/Index" class="btn btn-outline-danger btn-lg ml-2">Cancel</a>
                            </div>
                        </div>
                    </form>

                </div>
            </section>
        </div>
    </div>
</section>
<script>
    $(document).ready(function () {
        $("#MainSubmit").click(function (e) {
            e.preventDefault(); // Prevent default form submit

            var dataList = [];

            $("#MyTable tbody tr").each(function () {
                var mtransNo = $(this).find("td:eq(0)").text().trim(); // hidden field
                var isChecked = $(this).find("input[name='DtlCheckList']").is(":checked");

                //Pushing data in list
                dataList.push({
                    mtransNo: mtransNo,
                    isChecked: isChecked
                });
            });

            // Check if any checkbox is checked
            var hasChecked = dataList.some(function (item) {
                return item.isChecked;
            });

            if (!hasChecked) {
                $('#customToast1').text("Please check at least one item.").fadeIn(300).delay(4000).fadeOut(400);
                return; // Exit without AJAX
            }
            
            $.ajax({
                type: "POST",
                url: "/CleaningArea/UpdateData",
                contentType: "application/json",
                data: JSON.stringify(dataList),
                success: function (result) {
                    console.log("Success:", result);
                    $('#customToast').text("The bin is updated as Clean").fadeIn(300).delay(4000).fadeOut(400);
                },
                error: function (xhr, status, error) {
                    console.error("Error:", error);
                }
            });
        location.reload();
        });
    });


</script>


@Html.Partial("_jsfooter")
